package io.chsharp.lexpar;

<<<<<<< HEAD
import java.io.IOException;
import java.io.InputStream;
import java.io.PushbackInputStream;

public class LexersInputStream extends PushbackInputStream {
=======
import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;

public class LexersInputStream extends BufferedInputStream {
>>>>>>> b85e1b2c4ca638b1c49ad88c06d594c7462392be
	
	private int curLine = 0, curChar = -1;
	
	public LexersInputStream(InputStream in) {
<<<<<<< HEAD
		super(in, 2048);
=======
		super(in);
>>>>>>> b85e1b2c4ca638b1c49ad88c06d594c7462392be
	}
	
	public int getCurLine() {
		return this.curLine;
	}
	
	public int getCurChar() {
		return this.curChar;
	}
	
	@Override
	public synchronized int read() {
		try {
			int ret = super.read();
			
<<<<<<< HEAD
			if (ret == '\n') {
=======
			if(ret == '\n') {
>>>>>>> b85e1b2c4ca638b1c49ad88c06d594c7462392be
				curLine++;
				curChar = -1;
			}
			curChar++;
			
			return ret;
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
	}
	
<<<<<<< HEAD
	@Override
	public int read(byte[] b, int off, int len) {
		try {
			return super.read(b, off, len);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
	}
	
	@Override
	public void unread(byte[] b, int off, int len) {
		try {
			super.unread(b, off, len);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
	}
	
	@Override
	public synchronized void reset() {
		try {
			super.reset();
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
	}
	
	public int peek(int depth) {
		byte[] b = new byte[depth];
		try {
			read(b, 0, b.length);
			unread(b);
		} catch (IOException e) {
			e.printStackTrace();
		}
		if (b[depth - 1] == 0)
			return -1;
		else
			return b[depth - 1];
=======
	public int peek(int depth) {
		try {
			mark(depth);
			for (int i = 0; i < depth - 1; i++)
				read();
			int ret = read();
			reset();
			return ret;
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
>>>>>>> b85e1b2c4ca638b1c49ad88c06d594c7462392be
	}
	
}
